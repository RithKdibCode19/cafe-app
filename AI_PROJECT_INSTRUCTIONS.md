# Cafe POS System - Developer & AI Instruction Guide

## 1. Project Overview

This is a modern Point of Sale (POS) system designed for a cafe environment. It features a dual-application architecture:

- **Backend**: Spring Boot REST API handling business logic, database interactions, and security.
- **Frontend**: Nuxt.js (Vue 3) web application for the POS interface, admin dashboard, and kitchen display.

## 2. Technology Stack (Strict Versions)

Adhere strictly to these versions to avoid build failures.

### Backend

- **Framework**: Spring Boot 3.4.2
- **Language**: **Java 21** (CRITICAL: Do NOT use Java 25 or newer; strictly use Java 21 or 17).
- **Build Tool**: Maven 3.9+
- **Database**: PostgreSQL 16
- **Key Libraries**:
  - **Lombok**: 1.18.36 (Used for Entities/DTOs).
  - **MapStruct**: 1.6.0 (Used for Entity <> DTO mapping). _Note: Configured with `lombok-mapstruct-binding`._
  - **Spring Security + JWT**: For authentication.

### Frontend

- **Framework**: Nuxt 4 (Vue 3.5+)
- **Styling**: TailwindCSS
- **Language**: TypeScript

## 3. Architecture & Implementation Patterns

### Backend Patterns

1.  **Layered Architecture**: `Controller` -> `Service` -> `Repository` -> `Database`.
2.  **Dependency Injection**:
    - **PREFERRED**: Manual Constructor Injection for `Controllers` and `Services`.
    - **AVOID**: `@RequiredArgsConstructor` on complex classes where manual control is clearer or stability is required.
    - _Reason_: Recent build stability issues with JDK 21+ and Lombok have made manual constructors more reliable for this specific project.
3.  **DTOs & Mappers**:
    - Always use DTOs for API requests/responses.
    - Use `MapStruct` interfaces for mapping.
    - **DO NOT** write manual mapping code unless strictly necessary.
    - If MapStruct generation fails, check `pom.xml` processor configuration.
4.  **Global Exception Handling**:
    - centralized in `GlobalExceptionHandler.java`.
    - Returns standardized `ErrorResponse` objects.

### Frontend Patterns

1.  **Components**: Use functional Vue components (`<script setup lang="ts">`).
2.  **State Management**: Use Nuxt `useState` or Pinia (if configured).
3.  **API interaction**: Use Nuxt `useFetch` or `$fetch`.

## 4. Setup & Run Instructions

### Prerequisites

- **Java 21** installed and configured as `JAVA_HOME`.
- **Node.js 22+**.
- Docker (for Database).

### Running the Backend

1.  Ensure PostgreSQL is running (`docker-compose up -d postgres`).
2.  Navigate to `backend/`.
3.  Run:
    ```bash
    # Explicitly set JAVA_HOME if necessary
    JAVA_HOME=/usr/lib/jvm/java-21-openjdk mvn clean spring-boot:run -Dspring-boot.run.profiles=local
    ```
    _Note: The `-Dspring-boot.run.profiles=local` flag is crucial to load `application-local.properties`._

### Running the Frontend

1.  Navigate to `frontend/`.
2.  Run:
    ```bash
    npm run dev
    ```

## 5. Critical Caveats & Known Issues

1.  **Java 25 Incompatibility**: The project **WILL FAIL TO COMPILE** with Java 25 due to Lombok compatibility issues. **Always force Java 21**.
2.  **MapStruct & Lombok**: The `pom.xml` is carefully configured to allow these two to coexist. **DO NOT MODIFY** the `maven-compiler-plugin` configuration unless you are fixing a specific processor issue.
3.  **Duplicate Constructors**: Be careful when adding Lombok annotations (`@RequiredArgsConstructor`) to classes that already have manual constructors. This will cause compilation errors. Backend Controllers currently use **manual constructors**.

## 6. Directory Structure

- `backend/src/main/java/com/example/backend/`: Source code.
  - `controller/`: REST Endpoints.
  - `services/`: Business Logic.
  - `repository/`: JPA Repositories.
  - `model/`: JPA Entities.
  - `dto/`: Data Transfer Objects.
  - `mapper/`: MapStruct Interfaces.
  - `security/`: JWT & Auth logic.

---

_Generated by Antigravity Agent - 2026-02-11_
